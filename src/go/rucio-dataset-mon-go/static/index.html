<!DOCTYPE html>
<html lang="en">
<head>
    <title>Go Datatable (Serverside)</title>
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <!-- prepared using https://datatables.net/download/ -->
    <link
        href="https://cdn.datatables.net/v/dt/jq-3.6.0/jszip-2.5.0/dt-1.12.1/b-2.2.3/b-colvis-2.2.3/b-html5-2.2.3/b-print-2.2.3/cr-1.5.6/date-1.1.2/kt-2.7.0/rr-1.2.8/sc-2.0.6/sb-1.3.3/sp-2.0.1/sl-1.4.0/sr-1.1.1/datatables.min.css"
        rel="stylesheet"
        type="text/css"/>

    <!--  Please do not delete below CSSes, important for pretty view -->
    <link href="https://cdn.datatables.net/v/dt/dt-1.12.1/datatables.min.css" rel="stylesheet" type="text/css"/>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.11.4/css/dataTables.bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.bootstrap.min.css" rel="stylesheet">

    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: 'Trebuchet MS', sans-serif;
        }

        table td {
            word-break: break-all;
            width: auto;
            table-layout: fixed;
        }

        /* Id */
        table tr td:nth-child(1) {
            text-align: left;
        }

        /* RseType */
        table tr td:nth-child(2) {
            text-align: left;
        }

        /* Dataset */
        table tr td:nth-child(3) {
            text-align: left;
            width: 30%;
        }

        table tr td:nth-child(n+4):nth-child(-n+5) {
            text-align: center;
        }

        /* LastAccess, LastAccessMs, Max, Min, Avg, Sum, MaxTB, MinTB, AvgTB, SumTB */
        table tr td:nth-child(n+6):nth-child(-n+8) {
            text-align: right;
        }

        /* RSEs */
        table tr td:nth-child(9) {
            background-color: #FFFDEA;
            width: 15%;
        }

        footer {
            text-align: center;
            padding: 3px;
            background-color: white;
            color: darkred;
        }

    </style>
</head>


<body>
<div class="cms">
    <img alt="CMS"
         src="https://cds.cern.ch/record/1306150/files/cmsLogo_image.jpg" style="width: 5%; float:left">
    <h3 style="width: 100%;alignment: center">
        RUCIO DATASETS MONITORING
    </h3>
</div>

<div class="container" style="display:block; width:100%">
    <table class="go-datatable display compact" style="width:100%">
        <thead>
        <tr>
            <th>RseType</th>
            <th>Dataset</th>
            <th>LastAccess</th>
            <th>LastAccessMs</th>
            <th>MaxTB</th>
            <th>MinTB</th>
            <th>AvgTB</th>
            <th>SumTB</th>
            <th>RSEs</th>
        </tr>
        </thead>
        <tfoot style="color: cornflowerblue">
        <tr>
            <th>RseType</th>
            <th>Dataset</th>
            <th>LastAccess</th>
            <th>LastAccessMs</th>
            <th>MaxTB</th>
            <th>MinTB</th>
            <th>AvgTB</th>
            <th>SumTB</th>
            <th>RSEs</th>
        </tr>
        </tfoot>
    </table>
</div>

<!-- prepared using https://datatables.net/download/ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js" type="text/javascript"></script>
<script
    src="https://cdn.datatables.net/v/dt/jqc-1.12.4/jszip-2.5.0/dt-1.12.1/af-2.4.0/b-2.2.3/b-colvis-2.2.3/b-html5-2.2.3/b-print-2.2.3/cr-1.5.6/date-1.1.2/fc-4.1.0/fh-3.2.3/r-2.3.0/sb-1.3.3/sp-2.0.1/sl-1.4.0/sr-1.1.1/datatables.min.js"
    type="text/javascript"></script>
<!-- Please do not delete below JS which is required for footerCallback-->
<script src="https://cdn.datatables.net/fixedheader/3.2.3/js/dataTables.fixedHeader.min.js"
        type="text/javascript"></script>

<script>
    $(document).ready(function () {
        // Add a text input to each column footer cell
        $('.go-datatable tfoot th').each(function () {
            var title = $(this).text();
            $(this).html('<input type="text" placeholder="Search ' + title + '" />');
        });

        var table = $('.go-datatable').DataTable({
            processing: true,
            serverSide: true,
            scrollX: true,
            pageLength: 10,
            dom: "Brtpli", // no main search ("f"), just individual column search
            aLengthMenu: [
                [5, 10, 25, 50, 100],
                [5, 10, 25, 50, 100]
            ],

            ajax: {
                // Server side ajax
                url: "../api/datasets",
                method: "POST",
                contentType: 'application/json',
                data: function (d) {
                    return JSON.stringify(d);
                },
                processData: true,
                dataType: "json",
                searchDelay: 3000,
            },

            initComplete: function () {
                // Column search
                var api = this.api();
                api.columns().every(function () {
                    var that = this;
                    $('input', this.footer()).on('keyup change', $.fn.dataTable.util.throttle(
                            function (val) {
                                if (that.search() !== this.value) {
                                    that.search(this.value).draw();
                                }
                            },
                            1000 // Period: https://datatables.net/reference/api/%24.fn.dataTable.util.throttle()
                        )
                    );
                });
            },

            columns: [
                {data: "RseType"},
                {data: "Dataset"},
                {data: "LastAccess"},
                {data: "LastAccessMs"},
                {data: "MaxTB"},
                {data: "MinTB"},
                {data: "AvgTB"},
                {data: "SumTB"},
                {data: "RSEs"}
            ]
        });
    });
</script>

<footer>
    <p style="font-size: large">
        Developed by CMS Monitoring & Analytics
        <br><a href="https://its.cern.ch/jira/browse/CMSMONIT-474">CMSMONIT-474 </a>
    </p>
    <img alt="CERN CMS O&C" src="../static/img/oc_icon.png" width="200"          height="80">
    <p style="font-size: small">
        <br> Special thanks to Danilo for bringing up this service idea and to Valentin for his great
        suggestions&reviews
    </p>
    <br></br>
    <br></br>
</footer>
</body>

</html>
